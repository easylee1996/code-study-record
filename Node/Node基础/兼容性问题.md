# dart-sass替换node-sass

在node16版本，不支持node-sass(有时候叫sass-node)，而老版本的vue项目中，只要使用了scss和sass都要安装node-sass，更新node后，通常无法安装这两个依赖。

但是仍然不推荐使用16以下的版本，不支持pnpm，所有都推荐使用16及以上版本node。

推荐方法：

1: 卸载node-sass

```shell
// 第一种方式:  在package.json中的node-sass或者sass-node删除掉  卸载完以后建议重新下包 安装依赖
  
// 第二种方式:
npm uninstall node-sass
yarn remove node-sass
```

2: 安装 dart-sass

```scss
  // npm
  npm install --dev sass 
  
  // yarn
  yarn add sass --dev
```

3: 配置 vue.config.js 文件

```css
// 一般默认文件里是没有这个css配置的, 添加进去就好.
module.exports = {
  css: {
    loaderOptions: {
      sass: {
        implementation: require('sass'), // This line must in sass option
      },
    },
  }
 } 
```

4: 全局搜索 (/deep/  和 >>>)  替换为::v-deep

注意:

如果vue3.0之前vue2.0你使用了/deep/ 没有替换 将会报错

如果控制台报下面的错误, 可能是 `sass-loader` 版过旧, 建议将版本更新到 `7.1.0 +`

```vbnet
Module build failed (from ./node_modules/sass-loader/lib/loader.js):
Error: Cannot find module 'node-sass'
   at Function.Module._resolveFilename (internal/modules/cjs/loader.js:581:15)
   at Function.Module._load (internal/modules/cjs/loader.js:507:25)
   at Module.require (internal/modules/cjs/loader.js:637:17)
   at require (internal/modules/cjs/helpers.js:22:18)
   at Object.sassLoader (/path-of-your-project-directory/node_modules/sass-loader/lib/loader.js:24:22
```

项目中使用了stylelint , 可能需要修改下校验规则，在stylelint.config.js 代码如下

```java
java
复制代码module.exports = {
  rules: {
    'selector-pseudo-element-no-unknown': [ true,
      {
        ignorePseudoElements: ['v-deep'],
      }
    ],
  },
```

5.可能还需要安装下面的插件（有的项目的某些低版本插件需要）：

1. 添加如下依赖：否则不支持16，启动不起来

```json
"core-js": "^3.33.0",
"qs": "^6.11.2",
"html-webpack-plugin": "4.5.0"
```

2. 浏览器支持情况修改为：否则不支持一些特性

```json
"browserslist": [
    "defaults",
    "not IE 11",
    "maintained node versions"
  ]
```

## 其它一些注意事项

1. 统一使用node 16以上版本，不要再考虑去兼容14版本，使用nvm进行管理即可
2. 如果某些插件无法运行，尝试屏蔽掉即可
3. 统一使用pnpm来进行插件的安装，如果遇到无法加载的情况，将对应的插件屏蔽掉进行尝试，后面再安装回来即可
4. 有时候pnpm在安装一些插件的时候，无法安装的插件不会提示，而是一直卡顿，此时可以用npm来安装看一看是哪些插件卡住了
5. 如果实在不行，可以尝试全局梯子 + 复制终端代理，使用npm安装
6. 如果还是不行，可以尝试重启电脑，有时候真的有用

## 最后一招

当报错的时候，使用yarn安装，这个可以快速查看是什么插件导致安装错误，然后将对应的插件删除，再使用npm安装，安装好后，再将对应的插件安装回来

**安装顺序很重要，因为有的插件依赖其它插件**
